# 网络层：数据平面
网络层实现了主机到主机的通信服务。

与运输层和应用层不同的是，在网络中每一台主机和路由器中都有一个网络层部分。

网络层被分为两个部分，**数据平面**和**控制平面**。数据平面功能指网络层中每台路由器的功能，该数据平面功能决定到达路由器输入链路之一的数据报如何被转发到该路由器的输出链路之一。网络层的控制平面功能，即网络范围的逻辑，该控制平面功能控制数据报沿着从源主机到目的主机的端到端路径中路由器之间的路由方式。

## 网络层概述
网络层在路由器和主机中都存在。数据平面的主要作用是从其输入链路向其输出链路转发数据报；控制平面的主要作用是协调这些本地的每路由器转发动作，使得数据报沿着源和目的主机之间的路由器路径最终进行端到端传送。

### 转发和路由器选择：数据平面和控制平面
网络层的作用从表面上看极为简单，即将分组从一台发送主机移动到一台接收主机。为此，需要使用两种重要的网络层功能：
+ **转发：** 当一个分组到达某路由器的一条输入链路时，该路由器必须将该分组移动到适当的输出链路。转发是在数据平面中实现的唯一功能。
+ **路径选择：** 当分组从发送方流向接收方时，网络层必须决定这些分组所采用的路由或路径。计算这些路径的算法被称为**路由选择算法 (routing algorithm)**。

> **转发 (forwarding)** 是指将分组从一个输入链路接口转移到适当的输出链路接口的路由器本地动作。转发发生的时间尺度很短，因此通常用硬件来实现。

> **路由选择 (routing)** 是指定分组从源到目的地所采用的端到端路径的网络范围处理过程。路由选择发生的时间尺度长得多，因此通常用软件来实现。

每台路由器中有一个关键元素是它的**转发表 (forwarding table)**。路由器检查到达分组首部的一个或多个字段值，进而使用这些首部值在其转发表中索引，通过这种方法来转发分组。

**1. 控制平面：传统的方法**

路由器选择算法运行在每台路由器中，并且每台路由器都包含转发和路由选择两种功能。在一台路由器中的路由选择算法与在其他路由器中的路由选择算法通信，一计算出它的转发表的值。

**2. 控制平面：SDN方法**

路由器物理上分离的另一种方法，远程控制计算机和分发转发表以供每台路由器所使用。控制平面路由器选择功能与物理的路由器是分离的，即路由选择设备仅执行转发，而远程控制器计算并分发转发表。**软件定义网络 (Software-Defined Networking, SDN)** 是指网络控制器是由软件实现的，故网络是“软件定义的”。

### 网络服务模型
**网络服务模型 (network service model)：** 定义了分组在发送与接收端系统之间的端到端运输特性。网络层提供的某种可能的服务包括：
+ 确保交付。该服务确保分组将最终达到目的地。
+ 具有时延上界的交付服务。该服务不仅确保分组的交付，而且在特定的主机到主机时延上界内交付。
+ 有序分组交付。该服务确保分组以它们发送的顺序到达目的地。
+ 确保最小带宽。这种网络层服务模仿在发送和接收主机之间的一条特定比特率的传输链路行为。只要发送主机以低于特定比特率的速率传输比特，则所有的分组最终会交付到目的主机。
+ 安全性。对所有运输层报文段提供机密性。

因特网的网络层提供了单一的服务，称为**尽力而为 (best-effort service)**。使用尽力而为服务，传送的分组既不能保证以它们发送的顺序被接收，也不能保证它们最终交付；既不能保证端到端时延，也不能保证有最小的带宽。即便因特网的网络层服务是尽力而为的，但对于大部分因特网应用程序而言已经足够好。
